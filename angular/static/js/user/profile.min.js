/*! et 2014-08-11 13:34:18 by @Julien */
function profile(a,b,c,d){function e(a,b,c,d,e){function f(b,c){d.getUserDetail(b,c.id===b).then(function(b){a.user=b,function(b){var c=_.max(b,function(a){return a.score});c=c.score,_.each(b,function(a){a.size=a.score/1e3*100}),a.cat_score=b}(a.user.cat_score)},function(){})}var g=c.absUrl().split("profile/")[1];a.uid=g=(g||"").split(/\W/).shift(),function(a){for(var b=1*(new Date).getFullYear()+1,c=[],d=0;40>d;d++)b--,c.push({val:b,text:b});a.years=c}(a),a.user={},a._getUserDetail=f,d.getUser().then(function(a){f(g,a)}),e.getFollowNum(g).then(function(b){a.followee=b.data.followee,a.follower=b.data.follower},function(){}),a.follow=function(b){e.follow(b||g).then(function(){alert("ok"),a.followed=!0},function(a){alert("follow error:"+a.data.msg)})},a.unfollow=function(b){e.follow(b||g).then(function(){a.followed=!1},function(a){alert("follow error:"+a.data.msg)})},a.lookFollowee=function(b){e.getFollow({uid:g,type:"followee",page:b||1}).then(function(b){a.followers=b.data.data,a.followTmpl="followers.html"},function(a){alert(a.data.msg)})},a.lookFollower=function(b){e.getFollow({uid:g,type:"follower",page:b||1}).then(function(b){a.followers=b.data.data,a.followTmpl="followers.html"},function(a){alert(a.data.msg)})},a.editProfile=function(){a.profileEditing=!a.profileEditing,a.editProfileTmpl="editProfile.html"},a.uneditProfile=function(){a.profileEditing=!a.profileEditing,a.editProfileTmpl=""},a.newWorkEx={},a.addWorkEx=function(){var b={schools:[a.newWorkEx]};d.addWorkEx(b).then(function(){a.unAddWorkEx()},function(){})},a.unWorkEx=function(){a.addWorkExIng=!a.addWorkExIng,a.newWorkEx={}},a.newEduEx={},a.addEduEx=function(){var b={schools:[a.newEduex]};d.addEduEx(b).then(function(){a.unAddEduEx()},function(){})},a.unAddEduEx=function(){a.addEduExIng=!a.addEduExIng,a.newEduEx={}},a.$on("editSuccess",function(){f(g,a.user)})}function f(a,d,e,f){a.init=function(c){if(c.id){var c=a.user=b.extend({},c);delete c.cat_score,delete c.user_type}},a.uploadConf={url:c.ajaxApi.uploadPortrait,success:function(b){a.$apply(function(){a.user.portrait=b.portrait,a.user.portrait_id=b.portrait_id})},error:function(a){alert(a)}},a.submit=function(){f.edit(a.user).then(function(){a.uneditProfile(),a.$emit("editSuccess",{})},function(a){alert(a.data.msg)})}}function g(a){a.add=function(){a.editingWorkEx={},a.addIng=!a.addIng,a.addTmpl=a.addTmpl?void 0:"editWorkEx.html"},a.submit=function(){a.user.work_exp=a.user.work_exp||[],a.user.work_exp.push(a.editingWorkEx),a.add()},a.cancel=function(){a.add()}}function h(a){a.add=function(){a.editingEduEx={},a.addIng=!a.addIng,a.addTmpl=a.addTmpl?void 0:"editEduEx.html"},a.submit=function(){a.user.edu_exp=a.user.edu_exp||[],a.user.edu_exp.push(a.editingEduEx),a.add()},a.cancel=function(){a.add()}}function i(a){a.init=function(b){a.workExIndex=b},a.edit=function(c){a.editingWorkEx=b.copy(c),a.editing=!a.editing,a.editTmpl="editWorkEx.html"},a.remove=function(a,b){a.splice(b,1)},a.cancel=function(){a.editing=!a.editing,a.editTmpl=""}}function j(a){a.init=function(b){a.eduExIndex=b},a.edit=function(c){a.editingEduEx=b.copy(c),a.editing=!a.editing,a.editTmpl="editEduEx.html"},a.remove=function(a,b){a.splice(b,1)},a.cancel=function(){a.editing=!a.editing,a.editTmpl=""}}function k(a){function b(){var b=a.newWorkEx;return b.name&&b.position&&b.start_year&&b.end_year?!0:!1}a.init=function(b){a.newWorkEx=b},a.submit=function(){return b()?("undefined"==typeof a.newWorkEx.id?(a.user.work_exp=a.user.work_exp||[],a.user.work_exp.push(a.newWorkEx)):a.user.work_exp.splice(a.workExIndex,1,a.newWorkEx),void a.cancel()):alert("请完整填写公司名称，时间，职位。")}}function l(a){function b(){var b=a.newEduEx;return b.name&&b.major&&b.start_year&&b.end_year?!0:!1}a.init=function(b){a.newEduEx=b},a.submit=function(){return b()?("undefined"==typeof a.editingEduEx.id?(a.user.edu_exp=a.user.edu_exp||[],a.user.edu_exp.push(a.newEduEx)):a.user.edu_exp.splice(a.eduExIndex,1,a.newEduEx),void a.cancel()):alert("请完整填写学校名称，时间，专业。")}}var m=d||b.module("etApp",["etServices","etDirectives","etFilters","etAnimations","etControllers"]);m.controller("profileCtrl",["$scope","$http","$location","userManager","followManager",e]),m.controller("editProfileCtrl",["$scope","$http","$location","userManager",f]),m.controller("worksExCtrl",["$scope","$http","userManager",g]),m.controller("edusExCtrl",["$scope","$http","userManager",h]),m.controller("workExCtrl",["$scope","$http","userManager",i]),m.controller("eduExCtrl",["$scope","$http","userManager",j]),m.controller("editWorkExCtrl",["$scope","$http","userManager",k]),m.controller("editEduExCtrl",["$scope","$http","userManager",l])}