<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>数库注册</title>
</head>

<style>
    .vm{
        vertical-align: middle;
    }
    .fr{
        float: right;
    }
    .hr{
        text-align: right;
    }
    .input-1-2{
        width:50%;
    }
    .input-1{
        display: block;
        width: 100%;
    }
    input,button{
        font-family: inherit;
    }
    body{
        font-family: "Microsoft Yahei", FreeSans, Arimo, "Droid Sans", Helvetica, Arial, sans-serif;
        color: #434a54;
        line-height: 2;
    }
    input, select, .btn{
        font-size:inherit;
        box-sizing: border-box;
        padding:0 0.5em;
        line-height: 3.2;;
        height: 3.2em;
        border-radius: 0.2em;;
        border:solid 1px #9ca3ad;
    }
    .btn{
        white-space: nowrap;
        font-size: 1em;;
        color: #fff;
        background: #ff9916;
        border:none;
        border-bottom: 3px solid #ce934d;;
    }

    option{
        line-height:3.2;;
        height: 3.2em;
    }
    .fz-22{
        font-size: 22px;
    }
    .fc-y1{
        color: #e09c25;
    }
    label{
        display: block;
    }
    label b{
        color: #e9573f;;
        margin-right:0.5em;
    }
    table{
        width:100%;
    }
    header{
        text-align: center;

    }
    h1 strong{
        position: relative;
        padding: 0 1em;;
        background: #fff;
        top:0.5em;
    }
    h5{
        margin-top:0.5em;
        border-top: solid 1px #ccd1d9;
    }
    h1,h5,p{
       margin: 0;
    }
    div{
        margin:1em 0 0 0;
    }
    .warning{
        font-size:0.8em;
        line-height: 2.5;
        font-family: sans-serif;
        color: red;;
    }
    .status{
        text-align: center;
        color: red;
        font-weight: bold;
    }
    .green{
        color:green;
    }
</style>
<body>

<section style="padding: 1em 0.5em;">

    <header>
        <h1><strong>欢迎注册<span class="fc-y1">数库</span></strong></h1>
        <h5>Welcome to <span class="fc-y1">ChinaScope</span></h5>
    </header>

    <div>

        <p role="status" class="status"></p>

        <div>
            <label><b>*</b>手机号码</label>
            <input class="input-1" role="phoneNum" type="text" placeholder="目前仅支持中国大陆手机号">
            <p class="warning" role="msg"></p>
        </div>

        <div>
            <label><b>*</b>验证码:</label>
            <table>
                <tr>
                    <td><input type="text" placeholder="验证码不区分大小写" class="input-1 csf_mobile_ck" role="captcha" ></td>
                    <td class="hr"> <img src="{#$account_url#}/captcha/v6" height="42" class="vm" role="reGetcaptcha"></td>
                </tr>
            </table>

            <p class="warning" role="msg"></p>
        </div>

        <div>
            <label><b>*</b>手机验证码：</label>
            <table>
                <tr>
                    <td><input id="p-captcha" type="text" placeholder="" class="input-1" role="phoneCaptcha"></td>
                    <td class="hr"><button class="btn vm" style="font-size:0.8em;" role="getPhoneCaptcha">获取手机验证码</button></td>
                </tr>
            </table>
            <p class="warning" role="msg"></p>
        </div>

        <div>
            <label><b>*</b>密码：</label>
            <input class="input-1" type="password" placeholder="长度不得少于8位，可使用数字/字母/符号" role="pass">
            <p class="warning" role="msg"></p>
        </div>

        <div>
            <label><b>*</b>所在学校：</label>
            <select class="input-1" role="scholl" name="university">
                <option value="11">对外经济贸易大学</option>
                <option value="6">江西财经大学</option>
                <option value="7">中南财经政法大学</option>
                <option value="8">武汉大学</option>
                <option value="10">天津财经大学</option>
                <option value="9">上海对外经贸大学</option>
                <option value="99">其他</option>
            </select>
            <p class="warning" role="msg" role="msg"></p>
        </div>

        <div>
            <label><b>*</b>入学时间：</label>
            <table>
                <tr>
                    <td><input id="year" type="text" placeholder="" class="input-1" role="year"></td>
                    <td>&nbsp;年&nbsp;</td>
                    <td><input id="month" type="text" placeholder="" class="input-1" role="month"></td>
                    <td>&nbsp;月</td>
                </tr>
            </table>
            <p class="warning" role="msg"></p>
        </div>


        <div>
            <label><b>*</b>在读身份：</label>
            <select class="input-1" role="position" name='education'>
                <option value='1'>大专</option>
                <option value='2'>本科</option>
                <option value='3'>学士学位</option>
                <option value='4'>硕士学位</option>
                <option value='5'>博士学位</option>
            </select>
            <p class="warning" role="msg"></p>
        </div>

        <div>
            <button class="btn input-1" role="regBtn">注册</button>
        </div>

    </div>


</section>

<footer style="padding: 4em 0; text-align: center;">
    <img src="../../img/icons/icon-logo.png?__inline">
</footer>
<script type="text/javascript">
    document.domain = 'chinascope.net';
    var www_url = '{#$www_url#}';
    // var assets_url = 'http://my.assets.chinascope.net/vcn';
    // var fin_url = 'http://my.fin.chinascope.net';
    // var edb_url = 'http://my.edb.chinascope.net';
    // var ced_url = 'http://my.ced.chinascope.net';
    // var rrp_url = 'http://my.rrp.chinascope.net';
    // var pevc_url = 'http://my.pevc.chinascope.net';
    // var news_url = 'http://my.news.chinascope.net';
    // var file_url = 'http://my.file.chinascope.net';
    // var dfs_url = 'http://my.dfs.chinascope.net';
    // var pc_url = 'http://my.pc.chinascope.net';
    // var tools_url = 'http://my.tools.chinascope.net';
    // var ada_lang = 'szh';
    // var ada_skin = 'vcn';
    // var ada_theme = '0';
    // var assets_version = '0.1.1';
    // var user_id = '';
    // var user_name = '';
    // var acct_type = '';
    // var account_url = 'http://my.account.chinascope.net';
    var first_visit = '0';

    var user_allow_count = '5';
    var user_temporary_power = '0';
    var user_temporary_prompt = '';
</script>
<script type="text/javascript">
    var catcha_url = '{#$account_url#}/captcha/v2';
    var catcha_url3 = '{#$account_url#}/captcha/v3';
    var catcha_url4 = '{#$account_url#}/captcha/v4';
    var catcha_url5 = '{#$account_url#}/captcha/v5';
    var catcha_url6 = '{#$account_url#}/captcha/v6';
   
    var account_url = "{#$account_url#}";
    var invite_code = "{#$invite#}";
    var forward = "{#$forward#}";
</script>
<script src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
<script src="{#$account_assets_url#}/js/www/reg_mobile.js" type="text/javascript"></script>
<script>

    ///////////////////////////////////////////////////////
    //设置loading
    //////////////////////////////////////////////////////
    $.fn.setLoading = function(){

        var loading =  '<span style="margin:0.2em; auto;display:inline-block;width:100%;text-align:center;" role="_loading_"><svg width="16" height="16" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" version="1.1"><path d="M 150,0 a 150,150 0 0,1 106.066,256.066 l -35.355,-35.355 a -100,-100 0 0,0 -70.711,-170.711 z" fill="#3d7fe6"><animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 150 150" to="360 150 150" begin="0s" dur="1s" fill="freeze" repeatCount="indefinite" /></path></svg></span>';

        this.hide().after(loading);

        return this;
    };

    ///////////////////////////////////////////////////////
    //清除loading
    //////////////////////////////////////////////////////
    $.fn.clearLoading = function(){
        this.show().next('[role="_loading_"]').remove();
        return this;
    };


    var regCtrl = {};


    //点击注册按钮
   $('[role=regBtn]').click(function(){
       //验证字段
       var scholl_val = $('[role=scholl]').val();
        if(checkPhoneNum() && checkCaptcha() && checkPass() && checkScholl() && checkYear_month() && checkPosition()){
            var that = $(this).setLoading();
            $.ajax({
                type:'post',
                url: account_url + '/user/ajaxdoRegistByMobile',
                data:{
                    rtype:"mobile",
                    mobile:$("[role=phoneNum]").val(),
                    password:$('[role=pass]').val(),
                    mobile_code:$('[role=phoneCaptcha]').val(),
                    vafy_code : $('[role=captcha]').val(),
                    scholl: $('[role=scholl]').val(),
                    date: $('[role=year]').val()+'-'+$('[role=month]').val(),
                    user_education: $('[role=position]').val()
                },
                success: function(data) {
                    that.clearLoading();
                    /*
                     1:  注册成功， 一切OK
                     2:  验证码不匹配
                     3:  手机号被改过
                     4： 密码错误。
                     5:  手机号已经被注册掉。
                     6： 系统错误
                     */
                    var _data = $.parseJSON( data );
                    var status = $('[role=status]');
                    $('body').scrollTop({top:0}, 200);

                    switch(_data.code)
                    {
                        case "1":
                            status.addClass('green').text('注册成功.');

                           regist_doing( _data.info );
                            break;
                        case "2":
                            status.text('验证码不匹配');
                            break;
                        case "3":
                            status.text('手机号被改过')
                            break;
                        case "5":
                            status.text('手机号已经被注册掉')
                            break;
                        case "6":
                            status.text('系统错误')
                            break;
                        case "7":
                            status.text('验证码不匹配')
                            break;
                        case "7":
                            status.text('手机号被改过')
                            break;
                    }

                }
            });

        }

   });

    //更换验证码图片
    $('[role=reGetcaptcha]').click(function(){
        $(this).attr('src',catcha_url6 + '?t='+parseInt(Math.random()*999));
    });


    //获取手机验证码
    $('[role=getPhoneCaptcha]').click(function(){

        if(checkPhoneNum()){

            checkCaptcha();
            var that = $(this).setLoading();

            $.ajax({
                type:'post',
                url: account_url + '/user/ajaxGetMobileCode',
                data:{mobile:$('[role=phoneNum]').val(), authcode:'', mobile_type:'regist' ,vafy_code:$(".csf_mobile_ck").val()},
                success: function(data) {
                    that.clearLoading();
                    
                    /*
                     1:  发送成功， 一切OK
                     2:  未知错误的发送失败，可能是手机商的问题
                     3:  安全问题，过于频繁，要求输入验证码
                     4： 这个手机号已被注册，不能使用。

                     */

                    switch(data)
                    {
                        case "1":
                            alert('发送成功');
                            reGetphc();
                            break;
                        case "2":
                                alert('未知错误的发送失败，可能是手机商的问题');
                            break;
                        case "3":
                            break;
                        case "4":
                               alert('这个手机号已被注册，不能使用');
                            break;
                        case "7":
                               alert('验证码错误');
                            break;
                    }
                }
            });

        }

    });


    //手机号码校验
    function checkPhoneNum() {
        var el = $('[role=phoneNum]');
        var msg = el.closest('div').find('[role=msg]');
        var num = el.val();
        if(/^1[0-9][0-9]\d{8}$/.test(num)){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请填写正确的手机号码!');
        }
    }


    //验证码校验
    function checkCaptcha(){

        var el = $('[role=captcha]');
        var msg = el.closest('div').find('[role=msg]');
        var captcha = el.val();
        if(/^[\w\d]{4}$/.test(captcha)){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请填写正确的验证码!');
        }
    }

    //手机验证码校验
    function checkPhc(){
        var el = $('[role=phoneCaptcha]');
        var msg = el.closest('div').find('[role=msg]');
        var captcha = el.val();
        if(/^\d{6}$/.test(captcha)){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请填写正确的手机验证码!');
        }
    }

    //密码校验
    function checkPass(){
        var el =$('[role=pass]');
        var msg = el.closest('div').find('[role=msg]');
        var pass = el.val();

        if(/^[-_\w]{8,}$/.test(pass)){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('密码不符合格式!');
        }
    }


    //学校校验
    function checkScholl() {
        var el = $('[role=scholl]');
        var msg = el.closest('div').find('[role=msg]');
        var scholl = el.val();

        if(scholl){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请选择学校');
        }
    }

    //入学年份校验
    function checkYear_month(){
        var el = $('[role=year]');
        var year = el.val();
        var month = $('[role=month]').val();
        var msg = el.closest('div').find('[role=msg]');

        if(/\d{4}/.test(year) && year*1 < 2015 && year*1 > 1970 && /\d{1,2}/.test(month) && month*1 > 0 && month*1 < 13){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请正确填写入学时间');
        }
    }

    //身份校验
    function checkPosition(){
        var el = $('[role=position]');
        var msg = el.closest('div').find('[role=msg]');
        var position = el.val();

        if(position){
            msg.empty();
            return 1;
        }else{
            $('body').animate({scrollTop:el.offset().top},400);
            msg.text('请选择在读身份')
        }
    }


    function reGetphc(){
        var tip = $('<span style="font-size:0.8em;"><b>90</b>秒后重新获取.</span>');
        var b = tip.find('b');
        var c = $('[role=getPhoneCaptcha]').hide().after(tip);
        var n = 90;

        var timer = setInterval(function(){
            if(n--){
                b.text(n);
            }else{
                clearInterval(timer);
                tip.remove();
                c.show();
            }
        }, 1000);
    }
   


</script>

</body>
</html>